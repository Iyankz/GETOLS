{% extends "layouts/base.html" %}

{% block title %}{{ 'Edit Template' if template else 'Add Template' }} - GETOLS{% endblock %}

{% block page_title %}{{ 'Edit Template' if template else 'Create New Template' }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">{{ 'Edit: ' + template.name if template else 'New Provisioning Template' }}</h2>
    </div>
    <div class="card-body">
        <form method="post" action="{{ '/templates/' + template.id|string + '/edit' if template else '/templates/add' }}" class="form-container">
            
            <div class="form-section">
                <h3 class="form-section-title">Basic Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="name" class="form-label">Template Name *</label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-input" 
                            value="{{ template.name if template else (form_data.name if form_data else '') }}"
                            required 
                            maxlength="100"
                            placeholder="e.g., Internet 100Mbps"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="vlan" class="form-label">VLAN ID *</label>
                        <input 
                            type="number" 
                            id="vlan" 
                            name="vlan" 
                            class="form-input" 
                            value="{{ template.vlan if template else (form_data.vlan if form_data else '') }}"
                            required
                            min="1"
                            max="4094"
                            placeholder="1-4094"
                        >
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description" class="form-label">Description</label>
                    <textarea 
                        id="description" 
                        name="description" 
                        class="form-textarea" 
                        rows="2"
                        placeholder="Brief description of this template"
                    >{{ template.description if template else (form_data.description if form_data else '') }}</textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3 class="form-section-title">Profile Configuration</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="line_profile" class="form-label">Line Profile *</label>
                        <input 
                            type="text" 
                            id="line_profile" 
                            name="line_profile" 
                            class="form-input" 
                            value="{{ template.line_profile if template else (form_data.line_profile if form_data else '') }}"
                            required
                            maxlength="100"
                            placeholder="e.g., line-profile-100m"
                        >
                        <small class="form-hint">DBA profile name for bandwidth allocation</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="service_profile" class="form-label">Service Profile *</label>
                        <input 
                            type="text" 
                            id="service_profile" 
                            name="service_profile" 
                            class="form-input" 
                            value="{{ template.service_profile if template else (form_data.service_profile if form_data else '') }}"
                            required
                            maxlength="100"
                            placeholder="e.g., srv-profile-internet"
                        >
                        <small class="form-hint">Service port configuration profile</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="service_port_start" class="form-label">Service Port Start</label>
                        <input 
                            type="number" 
                            id="service_port_start" 
                            name="service_port_start" 
                            class="form-input" 
                            value="{{ template.service_port_start if template and template.service_port_start else (form_data.service_port_start if form_data else '') }}"
                            min="1"
                            placeholder="Optional - for auto-increment"
                        >
                        <small class="form-hint">Starting service port number for auto-assignment</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Options</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="is_default" value="true" 
                                    {% if template and template.is_default %}checked{% endif %}
                                    {% if form_data and form_data.is_default %}checked{% endif %}>
                                <span>Set as Default Template</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            {% if template %}
            <div class="form-group">
                <label class="form-label">Status</label>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="is_active" value="true" {% if template.is_active %}checked{% endif %}>
                        <span>Active</span>
                    </label>
                </div>
                <small class="form-hint">Inactive templates cannot be used for new ONU registrations</small>
            </div>
            {% endif %}
            
            <div class="form-actions">
                <a href="/templates" class="btn btn-outline">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    {{ 'Update Template' if template else 'Create Template' }}
                </button>
            </div>
        </form>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h2 class="card-title">ZTE OLT Profile Reference</h2>
    </div>
    <div class="card-body">
        <p>Common profile commands on ZTE OLTs:</p>
        
        <h4>Line Profile (DBA)</h4>
        <pre class="code-block">gpon-olt-lineprofile gpon profile-id 1 profile-name "line-profile-100m"
  tcont 1 dba-profile-id 1
  gem add 1 eth tcont 1
  gem mapping 1 0 vlan 100
  commit</pre>
        
        <h4>Service Profile</h4>
        <pre class="code-block">gpon-olt-srvprofile gpon profile-id 1 profile-name "srv-profile-internet"
  ont-port eth 1
  commit</pre>
        
        <h4>ONU Registration</h4>
        <pre class="code-block">interface gpon-olt_1/2/1
  ont add 1 sn-auth "ZTEG12345678" omci ont-lineprofile-id 1 ont-srvprofile-id 1 desc "Customer Name"</pre>
    </div>
</div>
{% endblock %}
