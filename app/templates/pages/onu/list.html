{% extends "layouts/base.html" %}

{% block title %}ONU List - GETOLS{% endblock %}

{% block page_title %}ONU List{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Provisioned ONUs</h3>
        <div class="card-header-actions">
            <select id="olt-filter" class="form-select" style="width: auto;" onchange="filterByOLT(this.value)">
                <option value="">All OLTs</option>
                {% for olt in olts %}
                <option value="{{ olt.id }}" {% if selected_olt and selected_olt.id == olt.id %}selected{% endif %}>
                    {{ olt.name }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="card-body">
        {% if onus %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Serial Number</th>
                        <th>Name</th>
                        <th>OLT</th>
                        <th>PON Port</th>
                        <th>VLAN</th>
                        <th>Status</th>
                        <th>RX Power</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for onu in onus %}
                    <tr>
                        <td>
                            <a href="/onu/{{ onu.id }}" class="table-link">
                                <code>{{ onu.serial_number }}</code>
                            </a>
                        </td>
                        <td>{{ onu.name or '-' }}</td>
                        <td>{{ onu.olt.name }}</td>
                        <td><code>{{ onu.full_location }}</code></td>
                        <td>{{ onu.vlan or '-' }}</td>
                        <td>
                            {% if onu.status.value == 'online' %}
                            <span class="badge badge-success">Online</span>
                            {% elif onu.status.value == 'offline' %}
                            <span class="badge badge-danger">Offline</span>
                            {% elif onu.status.value == 'low_signal' %}
                            <span class="badge badge-warning">Low Signal</span>
                            {% else %}
                            <span class="badge badge-secondary">Unknown</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="signal-{{ onu.signal_quality }}">
                                {{ onu.rx_power_display }}
                            </span>
                        </td>
                        <td>
                            <a href="/onu/{{ onu.id }}" class="btn btn-sm btn-outline">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>No ONUs found.</p>
            {% if user.can_discover() %}
            <a href="/onu/discovery" class="btn btn-primary btn-sm">Discover ONUs</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<script>
function filterByOLT(oltId) {
    if (oltId) {
        window.location.href = '/onu?olt_id=' + oltId;
    } else {
        window.location.href = '/onu';
    }
}
</script>

<style>
.signal-good { color: var(--success); }
.signal-fair { color: var(--warning); }
.signal-poor { color: #f97316; }
.signal-critical { color: var(--danger); }
.signal-unknown { color: var(--text-muted); }

.card-header-actions {
    display: flex;
    gap: 0.5rem;
}
</style>
{% endblock %}
