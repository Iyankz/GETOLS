{% extends "layouts/base.html" %}

{% block title %}{{ 'Edit User' if edit_user else 'Add User' }} - GETOLS{% endblock %}

{% block page_title %}{{ 'Edit User' if edit_user else 'Add New User' }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">{{ 'Edit User: ' + edit_user.username if edit_user else 'Create New User' }}</h2>
    </div>
    <div class="card-body">
        <form method="post" action="{{ '/users/' + edit_user.id|string + '/edit' if edit_user else '/users/add' }}" class="form-container">
            <div class="form-row">
                <div class="form-group">
                    <label for="username" class="form-label">Username *</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="form-input" 
                        value="{{ edit_user.username if edit_user else '' }}"
                        {% if edit_user %}readonly{% endif %}
                        required 
                        pattern="[a-zA-Z0-9_]+"
                        minlength="3"
                        maxlength="50"
                    >
                    <small class="form-hint">Letters, numbers, underscores only</small>
                </div>
                
                <div class="form-group">
                    <label for="full_name" class="form-label">Full Name</label>
                    <input 
                        type="text" 
                        id="full_name" 
                        name="full_name" 
                        class="form-input" 
                        value="{{ edit_user.full_name if edit_user and edit_user.full_name else '' }}"
                        maxlength="100"
                    >
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="email" class="form-label">Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input" 
                        value="{{ edit_user.email if edit_user and edit_user.email else '' }}"
                        maxlength="255"
                    >
                </div>
                
                <div class="form-group">
                    <label for="role" class="form-label">Role *</label>
                    <select id="role" name="role" class="form-select" required>
                        <option value="viewer" {% if edit_user and edit_user.role.value == 'viewer' %}selected{% endif %}>Viewer</option>
                        <option value="operator" {% if edit_user and edit_user.role.value == 'operator' %}selected{% endif %}>Operator</option>
                        <option value="admin" {% if edit_user and edit_user.role.value == 'admin' %}selected{% endif %}>Admin</option>
                    </select>
                    <small class="form-hint">
                        Admin: Full access | Operator: Discovery & Provisioning | Viewer: Read only
                    </small>
                </div>
            </div>
            
            {% if not edit_user %}
            <div class="form-section">
                <h3 class="form-section-title">Password</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="password" class="form-label">Password *</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-input" 
                            required
                            minlength="8"
                        >
                        <small class="form-hint">Min 8 chars, uppercase, lowercase, number</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm_password" class="form-label">Confirm Password *</label>
                        <input 
                            type="password" 
                            id="confirm_password" 
                            name="confirm_password" 
                            class="form-input" 
                            required
                        >
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if edit_user %}
            <div class="form-group">
                <label class="form-label">Status</label>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="is_active" {% if edit_user.is_active %}checked{% endif %}>
                        <span>Active</span>
                    </label>
                </div>
            </div>
            {% endif %}
            
            <div class="form-actions">
                <a href="/users" class="btn btn-outline">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    {{ 'Update User' if edit_user else 'Create User' }}
                </button>
            </div>
        </form>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h2 class="card-title">Role Permissions</h2>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>Permission</th>
                    <th>Admin</th>
                    <th>Operator</th>
                    <th>Viewer</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>View Dashboard</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-success">✓</span></td>
                </tr>
                <tr>
                    <td>View ONU List & Monitoring</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-success">✓</span></td>
                </tr>
                <tr>
                    <td>ONU Discovery</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-danger">✗</span></td>
                </tr>
                <tr>
                    <td>ONU Provisioning</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-danger">✗</span></td>
                </tr>
                <tr>
                    <td>OLT Management</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-danger">✗</span></td>
                    <td><span class="text-danger">✗</span></td>
                </tr>
                <tr>
                    <td>Template Management</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-danger">✗</span></td>
                    <td><span class="text-danger">✗</span></td>
                </tr>
                <tr>
                    <td>User Management</td>
                    <td><span class="text-success">✓</span></td>
                    <td><span class="text-danger">✗</span></td>
                    <td><span class="text-danger">✗</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
