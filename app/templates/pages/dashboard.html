{% extends "layouts/base.html" %}

{% block title %}Dashboard - GETOLS{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon stat-icon-blue">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stats.olts.total }}</span>
                <span class="stat-label">Total OLTs</span>
            </div>
            <div class="stat-footer">
                <span class="stat-badge stat-badge-success">{{ stats.olts.enabled }} enabled</span>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon stat-icon-green">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stats.onus.total }}</span>
                <span class="stat-label">Total ONUs</span>
            </div>
            <div class="stat-footer">
                <span class="stat-badge stat-badge-success">{{ stats.onus.online }} online</span>
                <span class="stat-badge stat-badge-danger">{{ stats.onus.offline }} offline</span>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon stat-icon-purple">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stats.users.total }}</span>
                <span class="stat-label">Total Users</span>
            </div>
            <div class="stat-footer">
                <span class="stat-badge">{{ stats.users.admins }} admins</span>
                <span class="stat-badge">{{ stats.users.operators }} operators</span>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon stat-icon-orange">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ activity_stats.total }}</span>
                <span class="stat-label">Actions (7 days)</span>
            </div>
            <div class="stat-footer">
                <span class="stat-badge stat-badge-success">{{ activity_stats.successful }} success</span>
                <span class="stat-badge stat-badge-danger">{{ activity_stats.failed }} failed</span>
            </div>
        </div>
    </div>
    
    <div class="dashboard-grid">
        <!-- OLT Status -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">OLT Status</h3>
                {% if user.can_manage_olt() %}
                <a href="/olt" class="btn btn-sm btn-outline">View All</a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if olts %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>IP</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for olt in olts %}
                            <tr>
                                <td>
                                    <a href="/olt/{{ olt.id }}" class="table-link">{{ olt.name }}</a>
                                </td>
                                <td>{{ olt.type_display }}</td>
                                <td><code>{{ olt.ip_address }}</code></td>
                                <td>
                                    {% if not olt.is_enabled %}
                                    <span class="badge badge-secondary">Disabled</span>
                                    {% elif olt.last_test_ro_success and olt.last_test_snmp_success %}
                                    <span class="badge badge-success">Online</span>
                                    {% elif olt.last_test_ro_success is none %}
                                    <span class="badge badge-warning">Not Tested</span>
                                    {% else %}
                                    <span class="badge badge-danger">Error</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>No OLTs configured yet.</p>
                    {% if user.can_manage_olt() %}
                    <a href="/olt/add" class="btn btn-primary btn-sm">Add OLT</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Recent Activity</h3>
                <a href="/activity" class="btn btn-sm btn-outline">View All</a>
            </div>
            <div class="card-body">
                {% if recent_activity %}
                <div class="activity-list">
                    {% for activity in recent_activity %}
                    <div class="activity-item">
                        <div class="activity-icon {% if activity.success %}activity-icon-success{% else %}activity-icon-error{% endif %}">
                            {% if activity.success %}
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            {% else %}
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                            {% endif %}
                        </div>
                        <div class="activity-content">
                            <span class="activity-action">{{ activity.action_display }}</span>
                            <span class="activity-user">by {{ activity.username }}</span>
                            <span class="activity-time">{{ activity.timestamp|datetime }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>No recent activity.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
